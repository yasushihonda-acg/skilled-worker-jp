# ADR-003: AIチャット設計

## ステータス
計画中（Phase 2で実装予定）

## コンテキスト
求職者からの問い合わせに母国語で即座に対応するため、AIチャット機能を実装する。

### 要件
- 5言語での応答
- 24時間対応
- よくある質問への自動回答
- 複雑な質問は人間にエスカレーション

## 決定

### アーキテクチャ

```
┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│   ユーザー   │────▶│  Next.js API │────▶│  Vertex AI  │
│  (ブラウザ)  │◀────│    Routes    │◀────│   Gemini    │
└─────────────┘     └──────────────┘     └─────────────┘
                           │
                           ▼
                    ┌──────────────┐
                    │   Google     │
                    │  Translate   │
                    └──────────────┘
```

### 技術選定

#### AI モデル
**Vertex AI Gemini 1.5 Flash** を採用

| 項目 | 値 |
|------|-----|
| モデル | gemini-1.5-flash |
| リージョン | asia-northeast1 |
| 最大トークン | 8,192 |

#### 理由
- 低コスト
- 高速レスポンス
- 多言語対応
- GCP統合

### チャットフロー

```
1. ユーザーがメッセージ送信（例: ネパール語）

2. Next.js API Route で受信
   ↓
3. Google Translate API で日本語に翻訳
   ↓
4. Vertex AI Gemini に送信
   - システムプロンプト（FAQ、サービス情報）
   - ユーザーメッセージ（日本語）
   ↓
5. Gemini から日本語で応答
   ↓
6. Google Translate API でユーザー言語に翻訳
   ↓
7. ユーザーに表示
```

### システムプロンプト設計

```
あなたは「skilled-worker-jp」のカスタマーサポートAIです。

【役割】
- 特定技能外国人の就職支援サービスに関する質問に回答
- 親切で分かりやすい説明
- 不明な点は担当者への連絡を案内

【対応範囲】
- サービスの説明
- 登録方法の案内
- 特定技能制度の基本情報
- よくある質問への回答

【対応範囲外】→ 担当者に連絡を促す
- 個別の求人紹介
- ビザ申請の具体的なアドバイス
- 法律相談
```

### UI設計

```
┌─────────────────────────────────┐
│ 💬 チャットで質問              │ ← ヘッダー
├─────────────────────────────────┤
│                                 │
│  ┌──────────────────────┐      │
│  │ こんにちは！何かお手伝い│      │ ← AI メッセージ
│  │ できますか？          │      │
│  └──────────────────────┘      │
│                                 │
│      ┌──────────────────────┐  │
│      │ 登録方法を教えて      │  │ ← ユーザーメッセージ
│      └──────────────────────┘  │
│                                 │
├─────────────────────────────────┤
│ [メッセージを入力...]    [送信] │ ← 入力欄
└─────────────────────────────────┘
```

### Phase 1（MVP）での実装範囲

- UIのみ実装（チャットウィンドウ）
- AI連携はモック（固定レスポンス）
- 「現在準備中です」のメッセージ表示

### Phase 2での実装

- Vertex AI 連携
- Google Translate 連携
- 会話履歴の保存（Firestore）
- エスカレーション機能

## 影響

### ポジティブ
- 24時間対応が可能
- 人的コストの削減
- 多言語でのコミュニケーション障壁を解消

### ネガティブ
- AI利用コスト
- 誤回答のリスク
- システム障害時の対応

### リスク対策

| リスク | 対策 |
|--------|------|
| 誤回答 | 免責事項の表示、エスカレーション導線 |
| コスト超過 | レート制限、キャッシュ活用 |
| 障害 | フォールバックUI（お問い合わせフォーム） |

## コスト試算

| 項目 | 単価 | 月間想定 | 月額 |
|------|------|---------|------|
| Gemini API | $0.075/1M tokens | 100万トークン | $75 |
| Translate API | $20/100万文字 | 50万文字 | $10 |
| **合計** | | | **約$85/月** |

※ 利用量に応じて変動

## 参考資料
- [Vertex AI Gemini API](https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini)
- [Cloud Translation API](https://cloud.google.com/translate/docs)
